(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[63],{"96a6":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",[a("q-card-actions",{attrs:{align:"left"}},[a("q-btn",{directives:[{name:"go-back",rawName:"v-go-back.single",modifiers:{single:!0}}],staticStyle:{width:"150px"},attrs:{color:"red",icon:"reply",label:"ត្រឡប់ក្រោយ"}},[a("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[t._v("ថយក្រោយ")])],1)],1),a("q-card",{staticClass:"my-card bg-grey-1",attrs:{flat:"",bordered:""}},[a("q-card-section",[a("q-form",{ref:"addForm",staticClass:"q-gutter-md",on:{submit:t.onSubmit}},[a("div",{staticClass:"row q-gutter-x-sm q-mb-sm"},[a("div",{staticClass:"col"},[a("div",{staticClass:"row"},[a("q-select",{staticClass:"col",attrs:{outlined:"",label:"ជ្រើសរើសអ្នកផ្គត់ផ្គង់",options:t.getSuppliers,square:"","lazy-rules":"",rules:[function(t){return!!t||"សូមជ្រើសរើសចន្លោះ"}]},model:{value:t.data.supplier_obj,callback:function(e){t.$set(t.data,"supplier_obj",e)},expression:"data.supplier_obj"}}),a("q-btn",{staticClass:"col-1",staticStyle:{height:"55px"},attrs:{dense:"",color:"primary",icon:"add"},on:{click:function(e){return t.$refs.SupplierAdd.show()}}})],1)]),a("q-select",{staticClass:"col",attrs:{outlined:"",label:"ជ្រើសរើសប្រភេទ",options:["Receive","Pending"],square:"","lazy-rules":"",rules:[function(t){return!!t||"សូមជ្រើសរើសចន្លោះ"}]},model:{value:t.data.purchase_status,callback:function(e){t.$set(t.data,"purchase_status",e)},expression:"data.purchase_status"}}),a("q-input",{staticClass:"col",attrs:{label:"ថ្ងៃទិញចូល",outlined:"",square:"",mask:"date",rules:["date"]},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{on:{input:function(){return t.$refs.qDateProxy.hide()}},model:{value:t.data.purchase_date,callback:function(e){t.$set(t.data,"purchase_date",e)},expression:"data.purchase_date"}})],1)],1)]},proxy:!0}]),model:{value:t.data.purchase_date,callback:function(e){t.$set(t.data,"purchase_date",e)},expression:"data.purchase_date"}})],1),a("div",{staticClass:"row q-gutter-x-sm q-mb-sm"},[a("q-input",{staticClass:"col",attrs:{type:"textarea",rows:"3",outlined:"",label:"សំគាល់",square:"","lazy-rules":"",rules:[function(t){return!!t||"សូមបំពេញចន្លោះ"}]},model:{value:t.data.description,callback:function(e){t.$set(t.data,"description",e)},expression:"data.description"}})],1),a("q-table",{attrs:{separator:"cell",title:"បញ្ចីទំនិញ នឹងតម្លៃសរុប $"+(t.data.amount=t.totalAmount),data:t.data_detail,columns:t.columns,"rows-per-page-options":[0],"hide-bottom":""},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",[a("q-td",[t._v("\n                "+t._s(e.pageIndex+1)+"\n              ")]),a("q-td",{key:"name",staticStyle:{width:"300px"}},[a("q-select",{staticClass:"col",attrs:{"use-input":"","input-debounce":"0",behavior:"dialog",options:t.options,square:"","lazy-rules":"",rules:[function(t){return!!t||"សូមជ្រើសរើសចន្លោះ"}]},on:{filter:t.filterFn,input:function(a){return t.onSelect(e.pageIndex,e.row.product_obj)}},model:{value:e.row.product_obj,callback:function(a){t.$set(e.row,"product_obj",a)},expression:"props.row.product_obj"}})],1),a("q-td",{staticStyle:{width:"200px"}},[a("q-input",{staticClass:"col",attrs:{readonly:"",type:"textarea",rows:"1",square:"","lazy-rules":"",rules:[function(t){return!!t||"សូមបំពេញចន្លោះ"}]},model:{value:e.row.description,callback:function(a){t.$set(e.row,"description",a)},expression:"props.row.description"}})],1),a("q-td",[a("q-input",{staticClass:"col",attrs:{readonly:"",square:"","lazy-rules":"",rules:[function(t){return!!t||"សូមបំពេញចន្លោះ"}]},model:{value:e.row.invent_type,callback:function(a){t.$set(e.row,"invent_type",a)},expression:"props.row.invent_type"}})],1),a("q-td",[a("q-input",{staticClass:"col",attrs:{type:"number",square:"","lazy-rules":"",rules:[function(t){return!!t||"សូមបំពេញចន្លោះ"}]},model:{value:e.row.qty,callback:function(a){t.$set(e.row,"qty",a)},expression:"props.row.qty"}})],1),a("q-td",[a("q-input",{staticClass:"col",attrs:{type:"number",square:"","lazy-rules":"",rules:[function(t){return!!t||"សូមបំពេញចន្លោះ"}]},model:{value:e.row.buy_price,callback:function(a){t.$set(e.row,"buy_price",a)},expression:"props.row.buy_price"}})],1),a("q-td",[a("q-input",{staticClass:"col",attrs:{type:"number",square:"","lazy-rules":"",rules:[function(t){return!!t||"សូមបំពេញចន្លោះ"}]},model:{value:e.row.sale_price,callback:function(a){t.$set(e.row,"sale_price",a)},expression:"props.row.sale_price"}})],1),a("q-td",[a("span",{staticClass:"text-bold",staticStyle:{"font-size":"large"}},[t._v("\n                  $"+t._s(e.row.qty*e.row.buy_price)+"\n                ")])]),a("q-td",[a("q-btn",{attrs:{outline:"",round:"",color:"negative",icon:"delete"},on:{click:function(a){return t.removeDataDetail(e.pageIndex)}}})],1)],1)]}}])}),a("q-separator",{attrs:{color:"orange",inset:""}}),a("q-btn",{staticClass:"col",attrs:{outline:"",color:"blue",icon:"add",label:"បន្ថែម"},on:{click:function(e){return t.addDataDetail()}}}),a("div",{staticClass:"row q-gutter-x-sm q-mb-sm"},[a("q-input",{staticClass:"col-3",attrs:{type:"number",label:"ថ្លៃចំណាយ",square:""},model:{value:t.data.paid_balance,callback:function(e){t.$set(t.data,"paid_balance",e)},expression:"data.paid_balance"}}),a("q-input",{staticClass:"col-3",attrs:{type:"number",label:"ថ្លៃជំពាក់",disable:"",square:""},model:{value:t.data.due_balance=t.getDueBalance,callback:function(e){t.$set(t.data,"due_balance = getDueBalance",e)},expression:"data.due_balance = getDueBalance"}})],1)],1)],1),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{staticStyle:{width:"150px",height:"50px"},attrs:{icon:"save",color:"primary",label:"រក្សារទុក"},on:{click:function(e){return t.$refs.addForm.submit()}}},[a("q-tooltip",{attrs:{"content-class":"bg-white text-primary"}},[t._v("Save")])],1)],1)],1),a("supplier-add",{ref:"SupplierAdd"})],1)},r=[],s=(a("8e6e"),a("8a81"),a("456d"),a("551c"),a("ac6a"),a("cadf"),a("06db"),a("5df3"),a("20d6"),a("967e")),o=a.n(s),i=a("c47a"),c=a.n(i),l=(a("96cf"),a("fa84")),u=a.n(l),p=(a("7f7f"),a("a8dc"));function d(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function f(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?d(Object(a),!0).forEach((function(e){c()(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var b=[],_={name:"StockEdit",components:{SupplierAdd:p["a"]},data:function(){return{columns:[{align:"left",name:"no",label:"ល.រ",field:"no",sortable:!0},{align:"left",name:"name",label:"ទំនិញ",field:"name",sortable:!0},{align:"left",name:"description",label:"ចំណាំ",field:"description",sortable:!0},{align:"left",name:"invent_type",label:"ប្រភេទស្តុក",field:"invent_type",sortable:!0},{align:"left",name:"qty",label:"ចំនួន",field:"qty",sortable:!0},{align:"left",name:"buy_price",label:"តម្លៃទិញ",field:"buy_price",sortable:!0},{align:"left",name:"sale_price",label:"តម្លៃលក់",field:"sale_price",sortable:!0},{align:"left",name:"total",label:"សរុប/មុខ",field:"total",sortable:!0},{align:"left",name:"option",label:"ដកចេញ",field:"option",sortable:!0}],data:{_id:null,supplier_obj:null,supplier:null,purchase_status:"Pending",purchase_date:null,description:"",amount:"0",paid_amount:"0",paid_balance:"0",due_balance:"0",due_amount:"0"},data_detail:[],data_product:b,options:b}},computed:{totalAmount:function(){var t=this,e=t.data_detail.map((function(t){return{total:t.qty*t.buy_price}})),a=0;return e.forEach((function(t){a+=t.total})),a},getDueBalance:function(){return this.totalAmount-this.data.paid_balance},getSuppliers:function(){return this.$store.getters["supplier/getSuppliers"].map((function(t){return{label:"".concat(t.name," from ").concat(t.company),_id:t._id}}))}},created:function(){var t=this;return u()(o.a.mark((function e(){var a,n;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t,n=a.data,e.next=4,a.$store.dispatch("stock/editStock",a.$route.params.id).then(function(){var t=u()(o.a.mark((function t(e){var r;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.data._id,n.supplier_obj={label:"".concat(e.data.supplier.name," from ").concat(e.data.supplier.company),_id:e.data.supplier._id},n.purchase_date=e.data.purchase_date,n.description=e.data.description,n.paid_balance=e.data.paid_balance,t.next=7,a.$store.dispatch("stock/fetchStockDetailByStock",r).then((function(t){t.data.map((function(t){t.product_obj={label:t.product.name,_id:t.product._id},t.description=t.product.description,t.invent_type=t.product.invent_type})),a.data_detail=t.data.map((function(t){return f(f({},t),{},{buy_price:"".concat(t.buy_price),sale_price:"".concat(t.sale_price),qty:"".concat(t.qty),stock_qty:"".concat(t.stock_qty)})}))}));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:return e.next=6,a.$store.dispatch("product/fetchProduct").then((function(t){t.status&&(a.data_product=t.data.map((function(t){return{description:t.description,invent_type:t.invent_type,buy_price:t.buy_price,sale_price:t.sale_price,label:t.name,_id:t._id}})))}));case 6:case"end":return e.stop()}}),e)})))()},methods:{onSelect:function(t,e){var a=this.data_product.findIndex((function(t){return t.label===e.label})),n=this.data_detail[t],r=this.data_product[a];n.description=r.description,n.invent_type=r.invent_type,n.buy_price="".concat(r.buy_price),n.sale_price="".concat(r.sale_price)},addDataDetail:function(){this.data_detail.push({stock:null,product:null,product_obj:null,description:"",invent_type:"",qty:1,buy_price:"0",sale_price:"0",total:"0"})},removeDataDetail:function(t){this.data_detail.splice(t,1)},filterFn:function(t,e){var a=this;e(""!==t?function(){var e=t.toLowerCase();a.options=a.data_product.map((function(t){return t})).filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}:function(){a.options=a.data_product.map((function(t){return t}))})},onSubmit:function(){var t=this;return u()(o.a.mark((function e(){var a,n,r;return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t,n=a.data,r=a.data_detail,n.supplier=n.supplier_obj._id,n._id=a.$route.params.id,n.paid_amount=n.paid_balance,n.due_amount=n.due_balance,e.next=9,a.$store.dispatch("stock/deleteStockDetail",a.$route.params.id).then(function(){var t=u()(o.a.mark((function t(e){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.status){t.next=3;break}return t.next=3,a.$store.dispatch("stock/updateStock",a.data).then(function(){var t=u()(o.a.mark((function t(e){var s,i;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.status){t.next=6;break}return t.next=3,e.data._id;case 3:s=t.sent,i=r.map(function(){var t=u()(o.a.mark((function t(r){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.data._id;case 2:return r.stock=t.sent,t.next=5,r.product_obj._id;case 5:return r.product=t.sent,t.next=8,n.purchase_status;case 8:return r.purchase_status=t.sent,t.next=11,r.qty;case 11:return r.stock_qty=t.sent,t.next=14,a.$store.dispatch("stock/storeStockDetail",r);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Promise.all(i).then(u()(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a.$store.dispatch("stock/fetchStockAfterDetail",s).then(function(){var t=u()(o.a.mark((function t(e){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.status){t.next=7;break}return t.next=3,a.$store.dispatch("stock/fetchStock");case 3:return t.next=5,a.$store.dispatch("stock/fetchStockDetailForReport");case 5:a.$q.loading.hide(),window.history.back();case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)}))));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 9:case"end":return e.stop()}}),e)})))()}}},m=_,y=a("2877"),h=a("eebe"),w=a.n(h),q=a("9989"),v=a("4b7e"),x=a("9c40"),k=a("05c0"),g=a("f09f"),S=a("a370"),$=a("0378"),C=a("ddd8"),j=a("27f9"),D=a("0016"),O=a("7cbe"),P=a("52ee"),Q=a("eaac"),z=a("bd08"),A=a("db86"),B=a("eb85"),F=a("2eeb"),I=Object(y["a"])(m,n,r,!1,null,"2a402768",null);e["default"]=I.exports;w()(I,"components",{QPage:q["a"],QCardActions:v["a"],QBtn:x["a"],QTooltip:k["a"],QCard:g["a"],QCardSection:S["a"],QForm:$["a"],QSelect:C["a"],QInput:j["a"],QIcon:D["a"],QPopupProxy:O["a"],QDate:P["a"],QTable:Q["a"],QTr:z["a"],QTd:A["a"],QSeparator:B["a"]}),w()(I,"directives",{GoBack:F["a"]})}}]);